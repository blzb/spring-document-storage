<div class="row">
    <div class="col-lg-3">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="file-manager">
                    <div class="pull-right">
                        <button rel="tooltip" data-toggle="tooltip" data-placement="top"
                                data-original-title="Subir más archivos" onclick="subirArchivo()"
                                class="btn btn-outline btn-primary dim" type="button"><i class="fa fa-cloud-upload"></i>
                        </button>
                        <button rel="tooltip" data-toggle="tooltip" data-placement="top"
                                data-original-title="Crear nueva carpeta" class="btn btn-outline btn-primary dim"
                                type="button" onclick="openFolderModal()"><i class="fa fa-folder-open-o"></i></button>
                        <button rel="tooltip" data-toggle="tooltip" data-placement="top"
                                data-original-title="Mostrar eliminados" class="btn btn-outline btn-primary dim"
                                type="button"><i class="fa fa-trash-o"></i></button>
                    </div>
                    <div class="clearfix"></div>
                    <div class="hr-line-dashed"></div>
                    <ul class="folder-list" style="padding: 0" id="folders">
                    </ul>
                    <h5 class="tag-title">Etiquetas</h5>
                    <ul class="tag-list" style="padding: 0">
                        <li><a href="#"><i class="fa fa-tag"></i> Tag</a></li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-9 animated fadeInRight">
        <div class="row wrapper white-bg">
            <div class="col-lg-10">
                <ol class="breadcrumb" id="ruta">
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <br/>

        <div class="row">
            <div class="col-lg-12" id="fileItems">
            </div>
        </div>

    </div>
</div>
<div class="modal inmodal" id="dropModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title">Agregar documentos</h4>
                <small class="font-bold">Aquí puedes agregar documentos arrasttrándolos o dando click en el recuadro.
                </small>
            </div>
            <div class="modal-body">

                <div>
                    <form id="my-awesome-dropzone" class="dropzone" action="#">
                        <div class="dz-message" data-dz-message=""><strong>No has subido ningún documento</strong></div>
                        <div class="dropzone-previews"></div>
                        <input type="hidden" value="Subscribe me!" th:value="${path}" name="path" id="path"/>
                        <button type="submit" class="btn btn-info pull-right">Guardar documentos!</button>
                    </form>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Crear</button>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal" id="folderModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title">Crear folder</h4>
                <small class="font-bold">Captura el nombre de la carpeta.
                </small>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" iname="folderName" id="folderName"/>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="createFolder();">Crear</button>
            </div>
        </div>
    </div>
</div>
<script src="/inspinia/js/plugins/dropzone/dropzone.js"></script>
<script>
    //Modal Config
    function subirArchivo() {
        jQuery("#dropModal").modal("toggle");
    }

    //Dropzone Config
    jQuery(document).ready(function () {
        Dropzone.options.myAwesomeDropzone = {
            autoProcessQueue: false,
            uploadMultiple: false,
            parallelUploads: 100,
            maxFiles: 100,
            paramName: 'file',
            url: "/repository/upload",
            // Dropzone settings
            init: function () {
                var myDropzone = this;
                this.element.querySelector("button[type=submit]").addEventListener("click", function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    myDropzone.processQueue();
                });
                this.on("sendingmultiple", function () {
                });
                this.on("successmultiple", function (files, response) {
                });
                this.on("errormultiple", function (files, response) {
                });
                this.on("queuecomplete", function (file) {
                    var ruta = $('#path').val();
                    loadFiles(ruta);
                    loadFolders(ruta);
                    myDropzone.removeAllFiles();
                });
            }
        };
        changeFolder($('#path').val());
    });
    function changeFolder(path) {
        loadFolders(path);
        loadFiles(path);
        $('#path').val(path);
        printPath(path);
    }
    function openFolderModal() {
        jQuery("#folderModal").modal("toggle");
    }
    function createFolder() {
        var path = $('#path').val();
        $.post('/repository/createFolder', {
                    path: path,
                    name: $('#folderName').val()
                }, function (data) {
                    loadFolders(path);
                    jQuery("#folderModal").modal("toggle");
                    $('#folderName').val('');
                }
        );

    }
    function loadFiles(pathValue) {
        $("#fileItems").html("");
        $.get('/repository/items', {path: pathValue}, function (data, status) {
            $.each(data, function (i, item) {
                $('<div class="file-box"><div class="file"><a href="#"><span class="corner"></span><div class="icon"><i class="fa fa-file"></i></div><div class="file-name">' +
                        '<span>' +
                        item.name +
                        '</span><br/><small>' +
                        item.lastModifiedDate +
                        '</small></div></a></div></div>')
                        .appendTo('#fileItems');
            });
        })
    }
    function loadFolders(pathValue) {
        $("#folders").html("");
        $.get('/repository/folders', {path: pathValue}, function (data, status) {
            $.each(data, function (i, item) {
                $('<li ><a href=""  onclick="changeFolder(\'' +
                        item.path +
                        '\'); return false;"><i class="fa fa-folder"></i><span>' + item.name + '</span></a></li>')
                        .appendTo('#folders');
            });
        })
    }
    function printPath(pathValue) {
        var acumulatedPath = '';
        var pathHtml = '<li><a href="" onclick="changeFolder(\'/\'); return false;"><i class="fa fa-folder-open"></i></a></li>';
        $(pathValue.split('/')).each(
                function (i, el) {
                    if (el) {
                        acumulatedPath = acumulatedPath + '/' + el;
                        pathHtml += '<li><a href="" onclick="changeFolder(\''+acumulatedPath+'\'); return false;"><span class="text-success"><strong>' + el + '</strong></span></a></li>'
                    }
                }
        );
        $('#ruta').html(pathHtml);
    }

</script>